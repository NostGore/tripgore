<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colaboradores | TripGore</title>
    <meta name="description"
        content="Descubre videos de nuestros colaboradores más activos en TripGore. Conoce a los creadores que aportan contenido de calidad.">
    <meta name="keywords"
        content="gore, tripgore, tripgore.space, forogore, foro gore, livegore, live gore, videos gore, gore videos, kaotic, forogore los zetas, colaboradores, creadores, comunidad, videos gore, tripgore space">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <meta name="author" content="TripGore Media">
    <link rel="canonical" href="https://tripgore.space/colaboradores.html">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="responsive/responsive.css">
    <link rel="stylesheet" href="css/colaboradores.css">

    <meta property="og:title" content="Colaboradores | TripGore">
    <meta property="og:description"
        content="Descubre videos de nuestros colaboradores más activos en TripGore.">
    <meta property="og:url" content="https://tripgore.space/colaboradores.html">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://tripgore.space/img/tripgore-logo.png">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Colaboradores | TripGore">
    <meta name="twitter:description"
        content="Descubre videos de nuestros colaboradores más activos en TripGore.">
    <meta name="twitter:image" content="https://tripgore.space/img/tripgore-logo.png">

    <meta name="theme-color" content="#0a0a0d">

    <!-- Favicon -->
    <link rel="icon" href="img/tripgore.png" type="image/png">

    <!--mtag -->
    <script src="https://upskittyan.com/act/files/tag.min.js?z=9387446" data-cfasync="false" async></script>
    <script src="https://vaugroar.com/act/files/tag.min.js?z=9394867" data-cfasync="false" async></script>
    <script type="text/javascript"
        src="//www.highperformanceformat.com/4ff7674ee0efefc410bbaf78b165b983/invoke.js"></script>
    <script type='text/javascript'
        src='//pl27981063.effectivegatecpm.com/20/7f/e9/207fe9e990d76c3be21e1645d4451b4b.js'></script>
    <script async="async" data-cfasync="false"
        src="//pl27981072.effectivegatecpm.com/7f1a939d1c154871b983db80cd0548b0/invoke.js"></script>
    <div id="container-7f1a939d1c154871b983db80cd0548b0"></div>

</head>

<body>
    <!-- Header Container - Se carga dinámicamente desde header.js -->
    <div id="header-container"></div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Sección de Colaboradores -->
        <section class="content-section">
            <div class="section-header">
                <h2 class="section-title">COLABORADORES</h2>
                <p class="section-subtitle">Descubre videos de nuestros colaboradores más activos</p>
            </div>

            <!-- Lista de Colaboradores -->
            <div class="colaboradores-container">
                <div class="colaboradores-grid" id="colaboradoresGrid">
                    <!-- Los colaboradores se cargarán dinámicamente aquí -->
                </div>
            </div>

            <!-- Videos del Colaborador Seleccionado -->
            <div class="colaborador-videos" id="colaboradorVideos" style="display: none;">
                <div class="colaborador-header">
                    <h3 id="colaboradorName">Videos de [Nombre]</h3>
                    <button class="back-to-colaboradores" onclick="showColaboradores()">
                        <i class="fa-solid fa-arrow-left"></i>
                        Volver a Colaboradores
                    </button>
                </div>
                <div class="colaborador-videos-grid" id="colaboradorVideosGrid">
                    <!-- Los videos del colaborador se cargarán aquí -->
                </div>
            </div>
        </section>

    </main>

    <!-- Scroll to Top Button -->
    <button class="scroll-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">↑</button>

    <!-- Incluir Firebase primero -->
    <script type="module" src="js/firebase.js"></script>

    <!-- Incluir la base de datos de videos -->
    <script src="database/mediaDB.js"></script>

    <!-- Incluir la base de datos de anuncios -->
    <script src="database/adsDB.js"></script>

    <!-- Incluir sistema de roles -->
    <script src="js/roles.js"></script>

    <!-- Incluir el archivo header.js después -->
    <script src="js/header.js"></script>

    <script src="js/music.js"></script>

    <script>
        // Funcionalidad de Colaboradores
        let colaboradoresData = [];
        let currentColaborador = null;

        // Función auxiliar para procesar un video y agregarlo al mapa de colaboradores
        function processVideo(colaboradoresMap, video) {
            // Excluir videos de TripGore
            if (video.autor === 'TripGore') return;

            const autor = video.autor;
            if (!autor) return;

            if (!colaboradoresMap.has(autor)) {
                colaboradoresMap.set(autor, {
                    id: autor.toLowerCase().replace(/[^a-z0-9]/g, ''),
                    name: autor,
                    avatar: autor.charAt(0).toUpperCase(),
                    videos: [],
                    videosCount: 0,
                    joinDate: video.fecha,
                    categories: new Set()
                });
            }

            const colaborador = colaboradoresMap.get(autor);
            colaborador.videos.push({
                id: video.id,
                title: video.titulo || video.title,
                category: video.categoria || video.category,
                date: video.fecha || video.date,
                link: video.video || video.link || video.videoUrl,
                portada: video.portada || video.thumbnail || video.cover
            });
            colaborador.videosCount++;
            colaborador.categories.add(video.categoria || video.category || 'GENERAL');
            
            // Actualizar joinDate si el video es más antiguo
            if (video.fecha || video.date) {
                const currentDate = new Date(colaborador.joinDate.replace(/(\d{2})\/(\d{2})\/(\d{4})/, '$3-$2-$1'));
                const videoDate = new Date((video.fecha || video.date).replace(/(\d{2})\/(\d{2})\/(\d{4})/, '$3-$2-$1'));
                if (videoDate < currentDate || isNaN(currentDate.getTime())) {
                    colaborador.joinDate = video.fecha || video.date;
                }
            }
        }

        // Función para obtener colaboradores desde mediaDB.js y Firebase
        async function getColaboradoresFromDB() {
            // Crear un mapa para agrupar videos por autor
            const colaboradoresMap = new Map();

            // 1. Procesar videos de mediaDB.js
            if (typeof mediaDB !== 'undefined' && Array.isArray(mediaDB)) {
                mediaDB.forEach(video => {
                    processVideo(colaboradoresMap, video);
                });
            } else {
                console.warn('mediaDB no está disponible');
            }

            // 2. Procesar videos de Firebase
            if (typeof window.getApprovedVideosOnce === 'function') {
                try {
                    const firebaseVideos = await window.getApprovedVideosOnce();
                    if (Array.isArray(firebaseVideos)) {
                        firebaseVideos.forEach(video => {
                            processVideo(colaboradoresMap, video);
                        });
                    }
                } catch (error) {
                    console.error('Error al obtener videos de Firebase:', error);
                }
            } else {
                console.warn('getApprovedVideosOnce no está disponible. Esperando a que Firebase se cargue...');
            }

            // Convertir a array
            const colaboradores = Array.from(colaboradoresMap.values()).map(colaborador => {
                delete colaborador.categories; // Limpiar datos temporales
                return colaborador;
            });

            // Ordenar por cantidad de videos
            return colaboradores.sort((a, b) => b.videosCount - a.videosCount);
        }

        // Cargar colaboradores
        async function loadColaboradores() {
            colaboradoresData = await getColaboradoresFromDB();
            renderColaboradores();
        }

        // Renderizar colaboradores
        function renderColaboradores() {
            const grid = document.getElementById('colaboradoresGrid');
            
            // Mostrar estado de carga
            grid.innerHTML = `
                <div class="loading-colaboradores">
                    <i class="fa-solid fa-circle-notch fa-spin"></i>
                    <p>Cargando colaboradores...</p>
                </div>
            `;
            
            let html = '';
            
            for (const colaborador of colaboradoresData) {
                html += `
                    <div class="colaborador-card" onclick="showColaboradorVideos('${colaborador.id}')">
                        <div class="colaborador-avatar">
                            ${colaborador.avatar}
                        </div>
                        <div class="colaborador-info">
                            <h3 class="colaborador-name" data-user-roles="${colaborador.name}">${colaborador.name}</h3>
                            <div class="colaborador-stats">
                                <div class="stat-item">
                                    <span class="stat-number">${colaborador.videosCount}</span>
                                    <span class="stat-label">Videos</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number">${new Date(colaborador.joinDate).getFullYear()}</span>
                                    <span class="stat-label">Miembro</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            grid.innerHTML = html;

            // Aplicar badges de colaborador
            setTimeout(() => {
                if (typeof window.applyColaboratorBadges === 'function') {
                    window.applyColaboratorBadges();
                }
            }, 100);
        }

        // Mostrar videos de un colaborador
        function showColaboradorVideos(colaboradorId) {
            const colaborador = colaboradoresData.find(c => c.id === colaboradorId);
            if (!colaborador) return;

            currentColaborador = colaborador;

            // Ocultar lista de colaboradores
            document.querySelector('.colaboradores-container').style.display = 'none';

            // Mostrar videos del colaborador
            document.getElementById('colaboradorVideos').style.display = 'block';
            
            const colaboradorNameEl = document.getElementById('colaboradorName');
            if (colaboradorNameEl) {
                colaboradorNameEl.innerHTML = '';
                colaboradorNameEl.appendChild(document.createTextNode('Videos de '));

                const badgeSpan = document.createElement('span');
                badgeSpan.textContent = colaborador.name;
                colaboradorNameEl.appendChild(badgeSpan);
            }

            // Renderizar videos
            renderColaboradorVideos(colaborador.videos);
        }

        // Renderizar videos del colaborador
        function renderColaboradorVideos(videos) {
            const grid = document.getElementById('colaboradorVideosGrid');
            const html = videos.map(video => `
                <div class="colaborador-video-card" onclick="window.location.href='video.html?id=${video.id}'">
                    <div class="video-thumbnail">
                        <img src="${video.portada}" alt="${video.title}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="video-thumbnail-fallback" style="display: none;">
                            <i class="fa-solid fa-video"></i>
                        </div>
                    </div>
                    <div class="video-info">
                        <h4 class="video-title">${video.title}</h4>
                        <div class="video-meta">
                            <span class="video-category">${video.category}</span>
                            <span class="video-date">${video.date}</span>
                        </div>
                    </div>
                </div>
            `).join('');

            grid.innerHTML = html;
        }

        // Volver a la lista de colaboradores
        function showColaboradores() {
            document.querySelector('.colaboradores-container').style.display = 'block';
            document.getElementById('colaboradorVideos').style.display = 'none';
            currentColaborador = null;
        }

        // Inicializar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function () {
            let hasLoaded = false;
            const startTime = Date.now();
            const maxWaitTime = 5000; // 5 segundos máximo
            
            // Esperar a que Firebase esté listo antes de cargar colaboradores
            function waitForFirebase() {
                if (hasLoaded) return; // Evitar cargar múltiples veces
                
                if (window.firebaseReady && typeof window.getApprovedVideosOnce === 'function') {
                    hasLoaded = true;
                    loadColaboradores();
                } else {
                    // Esperar un poco más si Firebase aún no está listo (máximo 5 segundos)
                    const elapsed = Date.now() - startTime;
                    if (elapsed < maxWaitTime) {
                        setTimeout(waitForFirebase, 100);
                    } else {
                        // Si Firebase no está disponible después de 5 segundos, cargar solo desde mediaDB
                        if (!hasLoaded) {
                            hasLoaded = true;
                            console.warn('Firebase no disponible después de esperar, cargando solo desde mediaDB');
                            loadColaboradores();
                        }
                    }
                }
            }
            
            // Esperar un poco antes de verificar Firebase para darle tiempo a cargar
            setTimeout(waitForFirebase, 200);
        });
    </script>
</body>

</html>

